---
import { postProcessProject, Project } from "$data/projects";
import type { GetStaticPaths, MDXInstance } from "$data/shared";
import ProjectLayout from "$layouts/ProjectLayout.astro";

export const getStaticPaths: GetStaticPaths = async () => {
  const projects = await Astro.glob<Project>("/content/projects/**/*.mdx");
  return await Promise.all(
    projects
      .filter((project) => project.frontmatter.external_url === undefined)
      .map(async (project) => {
        const augmentedFrontmatter = await postProcessProject(project.frontmatter, project.file);

        return {
          params: {
            type: augmentedFrontmatter.type + "s",
            slug: augmentedFrontmatter.slug,
          },
          props: { project },
        };
      }),
  );
};

interface Props {
  project: MDXInstance<Project>;
}

const { project } = Astro.props;
---

<ProjectLayout project={project} />
