---
import CatalogueItemLayout from "$layouts/CatalogueItemLayout.astro"
import { postProcessCatalogueItem, CatalogueItem } from "$data/catalogue"
import { getSlugFromFile } from "$utils"

export async function getStaticPaths() {
  let items = await Astro.fetchContent("/content/catalogue/**/*.md")
  items = await Promise.all(
    items.map(async (item) => {
      item = await postProcessCatalogueItem(item)

      return {
        params: { type: item.type + "s", slug: getSlugFromFile(item.file.pathname) },
        props: { item },
      }
    }),
  )

  return items
}

export interface Props {
  item: CatalogueItem
}

const { item } = Astro.props
---

<CatalogueItemLayout catalogueItem={item} />
