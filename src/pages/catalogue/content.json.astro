---
import { postProcessCatalogueItem, CatalogueItem } from "$data/catalogue"

let catalogueItems = await Astro.fetchContent("/content/catalogue/**/*.md")
catalogueItems = await Promise.all(
  catalogueItems.map(async (item) => await postProcessCatalogueItem(item as CatalogueItem)),
)

const json = JSON.stringify(
  catalogueItems
    .sort((a, b) => {
      return (b.ended_on ?? b.started_on).getTime() - (a.ended_on ?? a.started_on).getTime()
    })
    .map((item: CatalogueItem) => {
      return {
        title: item.title,
        cover: item.cover,
        creator: (item.author || item.developer || item.studio) ?? "Unknown",
        url: item.url.pathname,
        type: item.type,
      }
    }),
)
---

<body set:html={json}></body>
