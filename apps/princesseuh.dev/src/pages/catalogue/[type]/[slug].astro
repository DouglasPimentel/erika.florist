---
import CatalogueItemLayout from "$layouts/CatalogueItemLayout.astro"
import { postProcessCatalogueItem, CatalogueItem } from "$data/catalogue"
import { getSlugFromFile } from "$utils"

export async function getStaticPaths() {
  let items = await Astro.glob<CatalogueItem>("/content/catalogue/**/*.md")

  const catalogueItems = await Promise.all(
    items.map(async (item) => {
      const augmentedFrontmatter = await postProcessCatalogueItem(item.frontmatter, item.file)

      return {
        params: { type: augmentedFrontmatter.type + "s", slug: getSlugFromFile(item.file) },
        props: { item },
      }
    }),
  )

  return catalogueItems
}

export interface Props {
  item: CatalogueItem
}

const { item } = Astro.props as Props
---

<CatalogueItemLayout catalogueItem={item} />
